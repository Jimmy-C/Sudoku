"use strict";var GuessValuesWidget=function(){function a(a,b){h.subscribe(a,b)}function b(a){h.unsubscribe(a)}function c(a){function b(){j.remove(),h.publish(i.Dismissed)}function c(a){var b=$(a.target),c=parseInt(b.text(),10);j.remove(),h.publish(i.Guess_value,c)}h=new PubSub;var j=$(Sudoku.templates.GuessValuesWidget());j.find(e).on("click",".guess-value:not(.notSelectable)",c).find(f).each(function(b,c){-1!==a.indexOf(b+1)&&$(c).addClass("notSelectable")}),j.find(g).click(b),$(d).append(j)}var d="#sudoku-container",e=".guess-values-menu",f=".guess-value",g=".overlay",h=null,i={Guess_value:"guess_value",Dismissed:"dismissed"};return{show:c,subscribeEvent:a,unsubscribeEvent:b,Public_Events:i}}(),SudokuBoardData=function(){function a(){return b}var b=[[5,3,0,6,0,0,0,9,8],[0,7,0,1,9,5,0,0,0],[0,0,0,0,0,0,0,6,0],[8,0,0,4,0,0,7,0,0],[0,6,0,8,0,3,0,2,0],[0,0,3,0,0,1,0,0,6],[0,6,0,0,0,0,0,0,0],[0,0,0,4,1,9,0,8,0],[2,8,0,0,0,5,0,7,9]];return{generateBoardData:a}}(),SudokuChecker=function(){function a(a){return a.every(function(b,c){return c===a.indexOf(b)})}function b(a){return a.every(function(a){return!!a})}function c(a,b){var c=[];return a.forEach(function(a){(a.textContent||b)&&c.push(a.textContent)}),c}function d(a,b){g(a)?(b.subSquaresViolatingRules=b.subSquaresViolatingRules.concat(a),b.isGameSolved=!1):(b.subSquareObeyingRules=b.subSquareObeyingRules.concat(a),f(a)||(b.isGameSolved=!1))}function e(a){for(var b={subSquaresViolatingRules:[],subSquareObeyingRules:[],isGameSolved:!0},c=1;3>=c;c++)for(var e=1;3>=e;e++){var f=SudokuUtils.rowSubSquaresSelector(a,c,e),g=SudokuUtils.columnSubSquaresSelector(a,c,e);d(f,b),d(g,b)}for(var h=1;9>=h;h++){var i=SudokuUtils.tableSubSquaresSelector(a,h);d(i,b)}return b}function f(a){var d=c(a,!0);return b(d)}function g(b){var d=c(b);return!a(d)}return{checkIfGameSolved:e,isViolatingRules:g}}(),SudokuEndOfGameBannerWidget=function(){function a(){var a=["Congratulation!","Well done!","You're awesome!"],b=Math.floor(Math.random()*(a.length-0));return a[b]}function b(){f.remove(),g.publish(h.New_game)}function c(a,b){g.subscribe(a,b)}function d(a){g.unsubscribe(a)}function e(){g=new PubSub;var c={sudokuBannerText:a()};f=$(Sudoku.templates.SudokuGameSolvedBanner(c)),f.find(".sudoku-new-game-button").click(b),$("body").append(f);var d=$(".sudoku-banner-container").height();$(".sudoku-banner").css("line-height",d+"px")}var f,g=null,h={New_game:"new_game"};return{showBanner:e,subscribeEvent:c,unsubscribeEvent:d,Public_Events:h}}(),SudokuUtils=function(){function a(a,b){return"td[data-board-column="+a+"] td[data-sub-table-column="+b+"]"}function b(a,b){return"td[data-board-row="+a+"] td[data-sub-table-row="+b+"]"}function c(a){return"td[data-table="+a+"] td"}function d(a,c,d){var e=b(c,d);return a.find(e).toArray()}function e(b,c,d){var e=a(c,d);return b.find(e).toArray()}function f(a,b){var d=c(b);return a.find(d).toArray()}function g(a){var b=$(a),c=b.data(),d=$(b.parents("[data-table]")).data(),e=$.extend({},c,d);return e}function h(d,e){function f(a,b){b.textContent&&$(b).hasClass("initialDataValue")&&g.push(b.textContent)}var g=[],h=a(e.boardColumn,e.subTableColumn);d.find(h).each(f);var i=b(e.boardRow,e.subTableRow);d.find(i).each(f);var j=c(e.table);return d.find(j).each(f),$.unique(g).map(function(a){return parseInt(a,10)}).sort()}return{getInitialValuesBasedOn:h,geRowColumnDataBasedOn:g,rowSubSquaresSelector:d,columnSubSquaresSelector:e,tableSubSquaresSelector:f}}(),SudokuApp=function(){function a(){SudokuEndOfGameBannerWidget.showBanner(),SudokuEndOfGameBannerWidget.subscribeEvent(SudokuEndOfGameBannerWidget.Public_Events.New_game,b)}function b(){SudokuBoard.destroy(),$(d).empty(),c()}function c(){var b=SudokuBoard.generateBoard();SudokuBoard.subscribeEvent(SudokuBoard.Public_Events.Game_solved,a);var c=$(Sudoku.templates.SudokuInstruction());$(d).append(b).append(c)}var d="#sudoku-container";return{createBoard:c}}(),SudokuBoard=function(){function a(a,b){a.find("td").each(function(a,c){0!==b[a]&&$(c).addClass(k)})}function b(a,b){var c="violatingRules";a.forEach(function(a){var d=$(a);!d.hasClass("initialDataValue")&&d.text()&&$(a).toggleClass(c,b)})}function c(a){function c(a){var c=a!==parseInt(e.text(),10);if(e.removeClass("selected").text(a),e.addClass("hasGuessValue"),c){var d=SudokuChecker.checkIfGameSolved(j);b(d.subSquareObeyingRules,!1),b(d.subSquaresViolatingRules,!0),d.isGameSolved&&o.publish(p.Game_solved)}}function d(){e.removeClass("selected")}var e=$(a.target);e.addClass("selected");var f=SudokuUtils.geRowColumnDataBasedOn(e),g=SudokuUtils.getInitialValuesBasedOn(j,f);GuessValuesWidget.show(g),GuessValuesWidget.subscribeEvent(GuessValuesWidget.Public_Events.Dismissed,d),GuessValuesWidget.subscribeEvent(GuessValuesWidget.Public_Events.Guess_value,c)}function d(a){var c=$(a.target),d=c.text();if(d){c.text(""),c.removeClass("hasGuessValue");var e=SudokuChecker.checkIfGameSolved(j);b(e.subSquareObeyingRules,!1),b(e.subSquaresViolatingRules,!0)}}function e(a){l++,1===l?n=setTimeout(function(){c(a),l=0},m):(clearTimeout(n),d(a),l=0)}function f(a,b){o.subscribe(a,b)}function g(a){o.unsubscribe(a)}function h(){j=null,o=null}function i(){o=new PubSub;for(var b=$(Sudoku.templates.SudokuBoard()),c=SudokuBoardData.generateBoardData(),d=1;9>=d;d++){for(var f=c[d-1],g={},h=1;9>=h;h++)g[h]=0===f[h-1]?"":f[h-1];var i=$(Sudoku.templates.Sudoku3x3Table(g));a(i,f),b.find('[data-table="'+d+'"]').append(i)}return b.on("click",".sudoku-3x3-table td:not(.initialDataValue)",e),j=b,b}var j=null,k="initialDataValue",l=0,m=180,n=null,o=null,p={Game_solved:"game_solved"};return{generateBoard:i,destroy:h,subscribeEvent:f,Public_Events:p,unsubscribeEvent:g}}();